<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
 BADGE_ID                                  NOT NULL NUMBER
 BADGE_NAME                                         NVARCHAR2(30)
 BADGE_REQUIREMENT                                  VARCHAR2(30)
 BEDGE_CATEGORY                                     VARCHAR2(30)
 BADGE_THUMBNAIL                                    NVARCHAR2(30)
 -->
<mapper namespace="com.kosmo.shoong.badge.mybatis.badgesql">

	<resultMap type="badgeDTO" id="badgeDTOResult">
		<result property="badgeId" column="BADGE_ID"/>
		<result property="badgeName" column="BADGE_NAME"/>
		<result property="badgeRequirement" column="BADGE_REQUIREMENT"/>
		<result property="badgeCategory" column="BEDGE_CATEGORY"/>
		<result property="badgeThumbnail" column="BADGE_THUMBNAIL"/>
	</resultMap>
	
	<select id="whereIsMyBadge" parameterType="java.util.Map" resultType="integer">
		SELECT BADGE_ID
		FROM BADGE
		WHERE BADGE_CATEGORY='마일리지'
		AND TO_NUMBER(BADGE_REQUIREMENT) <![CDATA[>=]]>  TO_NUMBER(#{mileage})
		<!-- 
		AND BADGE_ID <![CDATA[>=]]> (SELECT MAX(BADGE_ID) FROM USER_BADGE_GET WHERE USER_ID=#{userId})
		 -->
	</select>

	<insert id="insertMileageBadge" parameterType="java.util.Map">
		<!-- 
		<selectKey resultType="integer" order="BEFORE" keyProperty="badgeIdList">
			SELECT BADGE_ID
			FROM BADGE
			WHERE BADGE_CATEGORY='마일리지'
			AND TO_NUMBER(BADGE_REQUIREMENT) <![CDATA[>]]>= TO_NUMBER(#{mileage})
		</selectKey>
		 -->
		 <!-- 
		INSERT INTO USER_BADGE_GET 
		
		<foreach collection="badgeIdList" item="badgeId" separator=";">
			VALUES (#{badgeId},#{userId},SYSDATE)
		</foreach>
		 -->
		INSERT INTO USER_BADGE_GET 
		VALUES (#{badgeId},#{userId},SYSDATE)
	</insert>

</mapper>